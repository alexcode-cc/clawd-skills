# InvestmentTracker-platform 使用指南

## 🚀 快速开始

### 1. 激活技能
当用户提到以下关键词时，自动激活此技能：
- "投资追踪"、"投资组合"、"持仓分析"
- "交易记录"、"投资回报"、"收益分析"
- "InvestmentTracker"、"投资分析报告"

### 2. 基本命令示例

#### 查看投资组合
```
用户：查看我的投资组合
技能：📊 投资组合概览
       ====================================================
       💰 总价值: $125,000.50
       📈 总投资: $100,000.00
       🎯 总收益: $25,000.50
       📊 收益率: 25.0%
       ...（详细资产持仓）
```

#### 查看交易记录
```
用户：显示最近的交易
技能：💱 交易记录
       ====================================================
       🟢 2026-02-16 BUY BTC 0.1000 × $42000.00 = $4200.00
       🔴 2026-02-15 SELL AAPL 5.0000 × $180.00 = $900.00
       ...（交易摘要）
```

#### 获取投资分析
```
用户：分析我的投资表现
技能：📈 投资分析报告
       ====================================================
       📊 表现分析:
         总收益率: 25.0%
         年化收益率: 18.5%
         夏普比率: 1.25
       ...（详细分析）
```

## 📊 功能详解

### 1. 投资组合功能
- **总览信息**：总价值、总投资、总收益、收益率
- **资产详情**：每个资产的持仓数量、当前价值、成本基础、未实现收益
- **分配比例**：各资产在总投资中的权重
- **现金管理**：现金持仓显示和管理建议

### 2. 交易记录功能
- **交易类型**：买入(BUY)、卖出(SELL)、股息(DIVIDEND)
- **详细信息**：交易时间、资产、数量、价格、总额、费用
- **交易摘要**：总买入额、总卖出额、总费用
- **交易备注**：每笔交易的说明和标签

### 3. 投资分析功能
- **表现分析**：收益率、年化收益、夏普比率、索提诺比率
- **风险指标**：波动率、最大回撤、在险价值(VaR)、贝塔系数
- **资产分配**：各类资产的分配比例和趋势
- **投资一致性**：胜率、盈亏比、盈利月份统计

## 🔧 技术实现

### 当前架构
```
InvestmentTrackerSkill
├── 数据层
│   ├── 模拟数据生成器
│   ├── API客户端（MCP协议）
│   └── 数据缓存管理器
├── 业务层
│   ├── 投资组合处理器
│   ├── 交易记录处理器
│   └── 分析引擎
└── 展示层
    ├── 文本格式化器
    ├── JSON输出器
    └── 图表生成器（计划中）
```

### 数据模式
- **模拟模式**：使用内置的模拟数据，无需API连接
- **API模式**：连接真实的InvestmentTracker MCP API
- **混合模式**：优先使用API，失败时自动降级到模拟数据

## 🎯 使用场景

### 场景1：每日投资检查
```
用户：今天我的投资情况如何？
技能：显示投资组合概览 + 当日变化分析
```

### 场景2：交易决策支持
```
用户：我想卖出部分AAPL，有什么建议？
技能：显示AAPL持仓详情 + 历史交易记录 + 卖出影响分析
```

### 场景3：投资表现评估
```
用户：这个季度我的投资表现怎么样？
技能：生成季度投资分析报告 + 与基准对比 + 改进建议
```

### 场景4：资产配置优化
```
用户：我的资产配置合理吗？
技能：分析当前资产分配 + 推荐优化方案 + 再平衡建议
```

## 📈 输出格式

### 1. 文本格式（默认）
```
📊 投资组合概览
========================================
💰 总价值: $125,000.50
📈 总投资: $100,000.00
🎯 总收益: $25,000.50
📊 收益率: 25.0%

📈 资产持仓:
----------------------------------------
BTC    Bitcoin         $22,500.00 (18.0%) 📈 12.5%
ETH    Ethereum        $6,250.00 (5.0%) 📈 25.0%
```

### 2. JSON格式（程序化访问）
```json
{
  "source": "simulated",
  "mode": "simulated",
  "data": {
    "total_value": 125000.50,
    "total_invested": 100000.00,
    "total_return": 25000.50,
    "return_percentage": 25.0,
    "assets": [...]
  },
  "timestamp": "2026-02-16T15:15:37Z"
}
```

### 3. 飞书卡片格式（计划中）
```
[飞书交互卡片]
┌─────────────────────┐
│   📊 投资组合概览   │
├─────────────────────┤
│ 总价值: $125,000.50 │
│ 总收益: $25,000.50  │
│ 收益率: 25.0%       │
└─────────────────────┘
[查看详情] [交易] [分析]
```

## 🔄 与MCP API集成

### API状态检查
技能会自动检查MCP API的可用性：
```python
# 自动检测API状态
if api_available:
    use_real_data()
else:
    use_simulated_data()
    show_api_status_message()
```

### 错误处理
- **API连接失败**：自动切换到模拟模式，显示友好提示
- **数据解析错误**：记录错误日志，使用上次成功数据
- **认证失败**：提示用户检查API密钥

### 数据同步
- **实时数据**：当API可用时获取最新数据
- **缓存机制**：减少API调用，提高响应速度
- **数据验证**：确保数据的完整性和准确性

## 🛠️ 配置选项

### 配置文件 (config.json)
```json
{
  "mode": "hybrid",
  "api": {
    "url": "https://investmenttracker-ingest-production.up.railway.app/mcp",
    "auth_token": "your_token_here",
    "timeout": 30,
    "retry_attempts": 3
  },
  "display": {
    "currency": "USD",
    "date_format": "YYYY-MM-DD",
    "show_emojis": true,
    "compact_mode": false
  },
  "features": {
    "portfolio": true,
    "transactions": true,
    "analysis": true,
    "alerts": false
  }
}
```

### 环境变量
```bash
export INVESTMENT_TRACKER_MODE="hybrid"
export INVESTMENT_TRACKER_API_TOKEN="your_token"
export INVESTMENT_TRACKER_CURRENCY="CNY"
```

## 📋 最佳实践

### 1. 定期使用建议
- **每日**：查看投资组合概览
- **每周**：分析交易记录和投资表现
- **每月**：生成完整的投资分析报告
- **每季度**：评估资产配置和调整策略

### 2. 数据安全
- **API密钥**：安全存储，定期轮换
- **敏感数据**：本地加密存储
- **访问日志**：记录所有数据访问

### 3. 性能优化
- **数据缓存**：减少重复API调用
- **批量处理**：合并相关数据请求
- **异步加载**：提高用户体验

## 🚨 故障排除

### 常见问题

#### Q1: 显示"模拟数据"而不是真实数据
**原因**: MCP API连接失败
**解决**: 
1. 检查网络连接
2. 验证API密钥
3. 查看API服务状态

#### Q2: 数据更新不及时
**原因**: 缓存机制或API延迟
**解决**:
1. 清除缓存
2. 手动刷新数据
3. 调整缓存时间

#### Q3: 特定功能不可用
**原因**: 功能未启用或API不支持
**解决**:
1. 检查配置文件
2. 查看API文档
3. 使用替代功能

### 调试模式
```bash
# 启用详细日志
export INVESTMENT_TRACKER_DEBUG=true

# 查看API请求详情
python3 simple_skill.py debug
```

## 🔮 未来规划

### 短期计划（1-2个月）
- [ ] 完整的MCP API集成
- [ ] 实时市场数据
- [ ] 投资警报功能
- [ ] 飞书卡片交互

### 中期计划（3-6个月）
- [ ] 多账户管理
- [ ] 税务报告生成
- [ ] 投资策略回测
- [ ] 机器学习分析

### 长期计划（6-12个月）
- [ ] 跨平台同步
- [ ] 智能投顾功能
- [ ] 社交投资功能
- [ ] 区块链集成

## 📞 支持与反馈

### 获取帮助
- **文档**: 查看本指南和SKILL.md
- **示例**: 查看examples/目录
- **测试**: 运行test_*.py文件

### 报告问题
1. 描述具体问题
2. 提供错误信息
3. 附上相关日志
4. 说明复现步骤

### 功能建议
欢迎提出新功能建议和改进意见！

---

*最后更新: 2026-02-16*
*版本: 1.0.0*